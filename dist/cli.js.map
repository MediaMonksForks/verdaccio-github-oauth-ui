{"version":3,"sources":["../constants.ts","../logger.ts","../npm.ts","../redirect.ts","cli-response.ts","usage.ts","../statusPage.ts","web-response.ts","index.ts"],"names":[],"mappings":"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","file":"cli.js","sourceRoot":"../src/cli","sourcesContent":["export const pluginName = \"oidc-ui\"\nexport const publicRoot = __dirname + \"/public\"\nexport const staticPath = \"/-/static/\" + pluginName\nexport const authorizePath = \"/-/oauth/authorize\"\nexport const callbackPath = \"/-/oauth/callback\"\n\nexport const cliPort = 8239\nexport const cliProviderId = \"cli\"\nexport const cliAuthorizeUrl = \"/oauth/authorize\"\n\nexport const publicGitHubOrigin = \"https://github.com\"\nexport const publicGitHubApiOrigin = \"https://api.github.com\"\n\n/**\n * See https://verdaccio.org/docs/en/packages\n */\nexport const authenticatedUserGroups = [\n  \"$all\",\n  \"@all\",\n  \"$authenticated\",\n  \"@authenticated\",\n] as const\n","import chalk from \"chalk\"\n\nimport { pluginName } from \"./constants\"\n\nconst prefix = chalk.blue(`[${pluginName}]`)\n\nexport const logger = {\n  log: console.log.bind(console, prefix),\n  error: console.error.bind(console, prefix),\n}\n\nconst plugin = require(__dirname + \"/../package.json\")\nlogger.log(`Version: ${plugin.name}@${plugin.version}`)\n","import { execSync } from \"child_process\"\nimport minimist from \"minimist\"\nimport { URL } from \"url\"\n\nimport { logger } from \"./logger\"\n\nfunction parseCliArgs() {\n  return minimist(process.argv.slice(2))\n}\n\nfunction runCommand(command: string) {\n  logger.log(`Running command: ${command}`)\n  return execSync(command)\n}\n\nfunction getNpmConfig() {\n  return JSON.parse(runCommand(\"npm config list --json\").toString())\n}\n\nfunction removeTrailingSlash(input: string) {\n  return input.trim().replace(/\\/?$/, \"\")\n}\n\nfunction ensureTrailingSlash(input: string) {\n  return input.endsWith(\"/\") ? input : `${input}/`\n}\n\nexport function getRegistryUrl() {\n  const cliArgs = parseCliArgs()\n  const npmConfig = getNpmConfig()\n\n  const registry = cliArgs.registry || npmConfig.registry\n\n  return removeTrailingSlash(registry)\n}\n\nexport function getNpmConfigFile() {\n  const npmConfig = getNpmConfig()\n\n  return npmConfig.userconfig\n}\n\nexport function getNpmSaveCommands(registry: string, token: string) {\n  const url = new URL(registry)\n  const pathname = ensureTrailingSlash(url.pathname)\n  const baseUrl = url.host + pathname\n\n  return [\n    `npm config set //${baseUrl}:always-auth true`,\n    `npm config set //${baseUrl}:_authToken \"${token}\"`,\n  ]\n}\n\nexport function saveNpmToken(token: string) {\n  const registry = getRegistryUrl()\n  const commands = getNpmSaveCommands(registry, token)\n\n  commands.forEach((command) => runCommand(command))\n}\n","import { authorizePath, callbackPath } from \"./constants\"\n\nexport function getAuthorizePath(id?: string) {\n  return authorizePath + \"/\" + (id || \":id?\")\n}\n\nexport function getCallbackPath(id?: string) {\n  return callbackPath + (id ? \"/\" + id : \"\")\n}\n","import { logger } from \"../logger\"\n\nexport function respondWithCliMessage(status: string, message: string) {\n  switch (status) {\n    case \"success\":\n      logger.log(\"All done! We've updated your npm configuration.\")\n      break\n\n    case \"denied\":\n      logger.log(\"You are not a member of the required access group.\")\n      break\n\n    default:\n      logger.error(message)\n      break\n  }\n}\n","import { pluginName } from \"../constants\"\nimport { logger } from \"../logger\"\nimport { getRegistryUrl } from \"../npm\"\n\nexport function getUsageInfo() {\n  return [\n    \"It seems you are using the default npm registry.\",\n    \"Please update it to your Verdaccio URL by either running:\",\n    \"\",\n    \"npm config set registry <URL>\",\n    \"\",\n    \"or by using the registry argument\",\n    \"\",\n    `npx verdaccio-${pluginName} --registry <URL>`,\n  ]\n}\n\nexport function printUsage() {\n  getUsageInfo().forEach((line) => logger.log(line))\n}\n\nexport function validateRegistry() {\n  const registry = getRegistryUrl()\n\n  if (registry.includes(\"registry.npmjs.org\")) {\n    printUsage()\n    process.exit(1)\n  }\n\n  return registry\n}\n","import { pluginName } from \"./constants\"\n\nexport function buildStatusPage(body: string, withBackButton: boolean) {\n  const backButton = withBackButton\n    ? `<p><button onclick=\"window.history.back()\">Go back</button></p>`\n    : \"\"\n\n  return `<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <title>${pluginName}</title>\n    <style>\n      html,\n      body {\n        padding: 0;\n        margin: 0;\n        height: 100%;\n        background-color: #e0e0e0;\n        color: #24292F;\n        font-family: Helvetica, sans-serif;\n        position: relative;\n        text-align: center;\n      }\n      .wrap {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n      }\n      a {\n        color: #3f51b5;\n      }\n      .img {\n        filter: drop-shadow(0 0.5rem 0.5rem #24292F80);\n        width: 100px;\n      }\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <svg class=\"img\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 100 100\"><defs/><defs><filter id=\"a\" width=\"139.6%\" height=\"140.4%\" x=\"-20%\" y=\"-12%\" filterUnits=\"objectBoundingBox\"><feOffset dy=\"4\" in=\"SourceAlpha\" result=\"shadowOffsetOuter1\"/><feGaussianBlur in=\"shadowOffsetOuter1\" result=\"shadowBlurOuter1\" stdDeviation=\"2.5\"/><feComposite in=\"shadowBlurOuter1\" in2=\"SourceAlpha\" operator=\"out\" result=\"shadowBlurOuter1\"/><feColorMatrix in=\"shadowBlurOuter1\" values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.0906646286 0\"/></filter><filter id=\"c\" width=\"167.9%\" height=\"272.7%\" x=\"-34%\" y=\"-50%\" filterUnits=\"objectBoundingBox\"><feOffset dy=\"4\" in=\"SourceAlpha\" result=\"shadowOffsetOuter1\"/><feGaussianBlur in=\"shadowOffsetOuter1\" result=\"shadowBlurOuter1\" stdDeviation=\"2.5\"/><feColorMatrix in=\"shadowBlurOuter1\" values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.0906646286 0\"/></filter><path id=\"b\" d=\"M48 17L33 47h-9L0 0h15l13 25 5-8h15z\"/><path id=\"d\" d=\"M35 11h-7V9h8l2-3h-6V4h7l1-2h-4V0h20l-6 11H35z\"/></defs><g fill=\"none\" fill-rule=\"evenodd\"><rect width=\"100\" height=\"100\" fill=\"#000\" rx=\"37\"/><g transform=\"translate(22 30)\"><use fill=\"#000\" filter=\"url(#a)\" xlink:href=\"#b\"/><use fill=\"#FFF\" fill-opacity=\".6\" xlink:href=\"#b\"/></g><g transform=\"translate(22 30)\"><use fill=\"#000\" filter=\"url(#c)\" xlink:href=\"#d\"/><use fill=\"#FFF\" xlink:href=\"#d\"/></g><path fill=\"#FFF\" d=\"M55 77h-9L22 30h15l21 41z\"/></g></svg>\n      ${body}\n      ${backButton}\n    </div>\n  </body>\n</html>`\n}\n\nexport function buildErrorPage(error: any, withBackButton: boolean) {\n  return buildStatusPage(\n    `<h1>Sorry :(</h1>\n    <p>${error?.message || error}</p>`,\n    withBackButton,\n  )\n}\n\nexport function buildAccessDeniedPage(withBackButton: boolean) {\n  return buildStatusPage(\n    `<h1>Access Denied</h1>\n    <p>You are not a member of the required access group.</p>`,\n    withBackButton,\n  )\n}\n","import { Response } from \"express\"\nimport { getNpmConfigFile } from \"../npm\"\n\nimport {\n  buildAccessDeniedPage,\n  buildErrorPage,\n  buildStatusPage,\n} from \"../statusPage\"\n\nconst withBackButton = false\n\nconst successPage = buildStatusPage(\n  `<h1>All done!</h1>\n  <p>We've updated your npm configuration.</p>\n  <p><code>${getNpmConfigFile()}</code></p>`,\n  withBackButton,\n)\n\nexport function respondWithWebPage(\n  status: string,\n  message: string,\n  res: Response,\n) {\n  res.setHeader(\"Content-Type\", \"text/html\")\n\n  switch (status) {\n    case \"success\":\n      res.status(200)\n      res.send(successPage)\n      break\n\n    case \"denied\":\n      res.status(401)\n      res.send(buildAccessDeniedPage(withBackButton))\n      break\n\n    default:\n      res.status(500)\n      res.send(buildErrorPage(message, withBackButton))\n      break\n  }\n}\n","import express from \"express\"\nimport open from \"open\"\n\nimport { cliPort, cliProviderId } from \"../constants\"\nimport { saveNpmToken } from \"../npm\"\nimport { getAuthorizePath } from \"../redirect\"\nimport { respondWithCliMessage } from \"./cli-response\"\nimport { validateRegistry } from \"./usage\"\nimport { respondWithWebPage } from \"./web-response\"\n\nconst registry = validateRegistry()\nconst authorizeUrl = registry + getAuthorizePath(cliProviderId)\n\nconst server = express()\n  .get(\"/\", (req, res) => {\n    let status = req.query.status as string\n    let message = req.query.message as string\n    const token = decodeURIComponent(req.query.token as string)\n\n    // We use `!status` for compatibility with plugin version <=2.3.0\n    // where there was no error handling and status differentiation yet.\n    if (!status) {\n      status = \"success\"\n    }\n\n    try {\n      if (status === \"success\") {\n        saveNpmToken(token)\n      }\n    } catch (error) {\n      status = \"error\"\n      message = error.message\n    }\n\n    respondWithWebPage(status, message, res)\n    respondWithCliMessage(status, message)\n\n    server.close()\n    process.exit(status === \"success\" ? 0 : 1)\n  })\n  .listen(cliPort, () => {\n    open(authorizeUrl)\n  })\n"]}